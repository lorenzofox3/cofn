<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Title</title>
</head>
<body>
<count-seconds since='2023-01-01'>
  X seconds have elapsed since the date
</count-seconds>
<script type='module'>
  import { define } from '@cofn/core';

  const roundElapsedSeconds = ({ time1, time2 }) => Math.round((time1.getTime() - time2.getTime()) / 1000);
  const { format: formatDate } = new Intl.DateTimeFormat();

  const withPeriodicUpdate = (viewFactory) => function* ({ $host, ...rest }) {
    const intervalId = setInterval(() => {
      $host.render();
    }, 1000);

    try {
      const view = viewFactory({ $host, ...rest });
      while (true) {
        const { attributes } = yield;
        view()
      }
    } finally {
      clearInterval(intervalId);
    }

  };

  const clockComponent = function* ({ $host }) {
    while (true) {
      const { attributes, now = new Date() } = yield;
      const sinceDate = new Date(attributes.since);
      $host.textContent = `${roundElapsedSeconds({
        time1: now,
        time2: sinceDate
      })} seconds have ellapsed since ${formatDate(sinceDate)}`;
    }
  };

  define('count-seconds', withPeriodicUpdate(clockComponent), {
    observedAttributes: ['since']
  });

</script>
</body>
</html>