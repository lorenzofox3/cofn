const e=e=>document.createComment(e),t=({node:t,templateCache:a})=>{const o=document.createRange(),r=e("before"),l=e("after");let i;return t.before(r),t.after(l),{replaceWith(e){if(o.setStartAfter(r),o.setEndBefore(l),function(e){if(Array.isArray(i)){const t=n(i),o=n(e);Object.entries(t).filter((([e])=>!(e in o))).forEach((([,e])=>{e.content.remove(),a.delete(e.key)}))}else o.deleteContents(),a.delete(i?.key)}(e),Array.isArray(e))e.forEach(((t,n)=>{const a=e[n-1]?.content??r;a.nextElementSibling!==t.content&&a.after(t.content)}));else if(e?.content){const{content:t}=e;o.insertNode(t),delete e.content}return i=e}}},n=e=>e.reduce(((e,t)=>({...e,[t.key]:t})),{}),a="__AS__",o=e=>document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,{acceptNode(e){if(1===e.nodeType){return[...e.attributes].some((e=>e.value?.includes(a)))?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}return 3===e.nodeType&&e.textContent.includes(a)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});function*r(e){let{currentNode:t}=e;for(t=11===t.nodeType?e.nextNode():t;t;)yield*1===t.nodeType?new Set([...t.attributes].filter((e=>e.value?.includes(a)))):[t],t=e.nextNode()}const l=e=>3===e.nodeType?e.textContent===a?e:[...i(e)]:e;function*i(e){if(!e.textContent.includes(a))return;const t=e.textContent.indexOf(a),n=e.splitText(t+6),o=document.createTextNode(""),r=new Range;r.setStart(e,t),r.setEndAfter(e),r.deleteContents(),r.insertNode(o),yield o,yield*i(n)}const s=Symbol("value"),c=Symbol("activeSite"),d=({templateParts:e,interpolatedValues:t})=>{const[n,...o]=e,r=""===n&&o?.[0].startsWith("::"),l=((r?o.shift().slice(2):n)+o.map((e=>a+e)).join("")).trim();return{isKeyed:r,key:r?t[0]:l,template:l}},u=({blueprint:e,isKeyed:t})=>{const n=document.createElement("template");n.innerHTML=e;const a=n.content.cloneNode(!0);if(t&&a.childElementCount>1)throw new Error("Keyed template can only have one root node");return t?a.children.item(0):a},m=({content:e,interpolatedValues:t,templateCache:n,$signal:a})=>{return(i=e,[...r(o(i))].flatMap(l)).map(((e,o)=>h({node:e,initialValue:t[o],templateCache:n,$signal:a})));var i},p=({node:e})=>t=>e.textContent=t,y=({node:e,templateCache:n})=>{const a=t({node:e,templateCache:n});return e=>a.replaceWith(e)},f={2:({node:e,$signal:t})=>{const{name:n}=e;return n.startsWith("@")?(({node:{ownerElement:e,name:t},$signal:n})=>{e.removeAttribute(t);const a=o=>{const r=t.slice(1),l=a[s];return l&&e.removeEventListener(r,l),e.addEventListener(r,o,{signal:n}),o};return a})({node:e,$signal:t}):n.startsWith(".")?(({node:{ownerElement:e,name:t}})=>(e.removeAttribute(t),n=>e[t.slice(1)]=n))({node:e}):(({node:{ownerElement:e,name:t}})=>n=>("boolean"==typeof n?!1===n?e.removeAttribute(t):e.setAttribute(t,"true"):e.setAttribute(t,n),n))({node:e})},3:({node:e,initialValue:t,templateCache:n})=>!0===t?.[c]||null===t||Array.isArray(t)?y({node:e,templateCache:n}):p({node:e})},h=({node:e,initialValue:t,templateCache:n,$signal:a})=>f[e.nodeType]({node:e,initialValue:t,templateCache:n,$signal:a}),C=([e,t])=>!Object.is(e[s],t),E=e=>function*(t){const{$root:n,$signal:a}=t,o=new Map,r=e({...t,html:T({$signal:a,templateCache:o})}),l="function"==typeof r?r:()=>r,i=l(yield);n.replaceChildren(i.content),delete i.content;try{for(;;)l(yield)}finally{o.clear()}},T=({$signal:e,templateCache:t})=>(n,...a)=>{const o=(({templateParts:e,interpolatedValues:t,templateCache:n,$signal:a})=>{const{template:o,...r}=d({templateParts:e,interpolatedValues:t});if(!n.has(r.key)){const e=u({blueprint:o,isKeyed:r.isKeyed});n.set(r.key,{[c]:!0,...r,content:e,updateFns:m({templateCache:n,content:e,interpolatedValues:r.isKeyed?t.slice(1):t,$signal:a})})}return n.get(r.key)})({templateParts:n,interpolatedValues:a,templateCache:t,$signal:e}),r=o.isKeyed?a.slice(1):a;var l,i;return(l=o.updateFns,i=r,l.map(((e,t)=>[e,i[t]]))).filter(C).forEach((([e,t])=>{e[s]=e(t)})),o};export{T as createHTML,E as withView};
